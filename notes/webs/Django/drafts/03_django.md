# åˆ›å»ºèœå•ç•Œé¢ï¼ˆDjangoåŸºç¡€ï¼‰

- ä½œè€…ï¼šyxc
- é“¾æ¥ï¼šhttps://www.acwing.com/file_system/file/content/whole/index/content/3199626/
- æ¥æºï¼šAcWing
- è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚

<!-- @import "[TOC]" {cmd="toc" depthFrom=3 depthTo=3 orderedList=false} -->

<!-- code_chunk_output -->

- [é¡¹ç›®ç»“æ„ä¸ç´ æ](#é¡¹ç›®ç»“æ„ä¸ç´ æ)
- [æ“ä½œè·¯å¾„è®°å½•](#æ“ä½œè·¯å¾„è®°å½•)
- [æ€»ç»“](#æ€»ç»“)

<!-- /code_chunk_output -->

ç»†åˆ†ç›®å½•ï¼š

<!-- @import "[TOC]" {cmd="toc" depthFrom=3 depthTo=4 orderedList=false} -->

<!-- code_chunk_output -->

- [é¡¹ç›®ç»“æ„ä¸ç´ æ](#é¡¹ç›®ç»“æ„ä¸ç´ æ)
  - [é¡¹ç›®ç³»ç»Ÿè®¾è®¡](#é¡¹ç›®ç³»ç»Ÿè®¾è®¡)
  - [é¡¹ç›®æ–‡ä»¶ç»“æ„](#é¡¹ç›®æ–‡ä»¶ç»“æ„)
  - [æœ¬èŠ‚è¯¾ç”¨åˆ°çš„ç´ æåœ°å€](#æœ¬èŠ‚è¯¾ç”¨åˆ°çš„ç´ æåœ°å€)
- [æ“ä½œè·¯å¾„è®°å½•](#æ“ä½œè·¯å¾„è®°å½•)
  - [é¦–å…ˆæ•´ç†é¡¹ç›®ç»“æ„](#é¦–å…ˆæ•´ç†é¡¹ç›®ç»“æ„)
  - [ä¿®æ”¹å…¨å±€é…ç½®](#ä¿®æ”¹å…¨å±€é…ç½®)
  - [jsæ‰“åŒ…](#jsæ‰“åŒ…)
  - [htmlç»“æ„](#htmlç»“æ„)
  - [åˆå§‹åŒ– JavaScript](#åˆå§‹åŒ–-javascript)
  - [å†™ views å’Œ urls](#å†™-views-å’Œ-urls)
  - [é…ç½®å®Œæˆï¼Œå¼€å§‹å†™jsæ¸²æŸ“å‡½æ•°](#é…ç½®å®Œæˆå¼€å§‹å†™jsæ¸²æŸ“å‡½æ•°)
- [æ€»ç»“](#æ€»ç»“)

<!-- /code_chunk_output -->

### é¡¹ç›®ç»“æ„ä¸ç´ æ

#### é¡¹ç›®ç³»ç»Ÿè®¾è®¡

- `menu`ï¼šèœå•é¡µé¢
- `playground`ï¼šæ¸¸æˆç•Œé¢
- `settings`ï¼šè®¾ç½®ç•Œé¢

#### é¡¹ç›®æ–‡ä»¶ç»“æ„
- `templates`ç›®å½•ï¼šç®¡ç†`html`æ–‡ä»¶
- `urls`ç›®å½•ï¼šç®¡ç†è·¯ç”±ï¼Œå³é“¾æ¥ä¸å‡½æ•°çš„å¯¹åº”å…³ç³»
- `views`ç›®å½•ï¼šç®¡ç†`http`å‡½æ•°ï¼ˆæˆ‘è®¤ä¸ºæ˜¯è´Ÿè´£è¿”å› `http` æ¸²æŸ“å†…å®¹ï¼‰
- `models`ç›®å½•ï¼šç®¡ç†æ•°æ®åº“æ•°æ®
- `static`ç›®å½•ï¼šç®¡ç†é™æ€æ–‡ä»¶ï¼Œæ¯”å¦‚ï¼š
  - `css`ï¼šå¯¹è±¡çš„æ ¼å¼ï¼Œæ¯”å¦‚ä½ç½®ã€é•¿å®½ã€é¢œè‰²ã€èƒŒæ™¯ã€å­—ä½“å¤§å°ç­‰
  - `js`ï¼šå¯¹è±¡çš„é€»è¾‘ï¼Œæ¯”å¦‚å¯¹è±¡çš„åˆ›å»ºä¸é”€æ¯ã€äº‹ä»¶å‡½æ•°ã€ç§»åŠ¨ã€å˜è‰²ç­‰
  - `image`ï¼šå›¾ç‰‡
  - `audio`ï¼šå£°éŸ³
  - â€¦
- `consumers`ç›®å½•ï¼šç®¡ç†`websocket`å‡½æ•°

#### æœ¬èŠ‚è¯¾ç”¨åˆ°çš„ç´ æåœ°å€

- [èƒŒæ™¯å›¾ç‰‡](https://gimg2.baidu.com/image_search/src=http%3A%2F%2Finews.gtimg.com%2Fnewsapp_match%2F0%2F11156556256%2F0.jpg&refer=http%3A%2F%2Finews.gtimg.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg)
  - ä¸‹è½½æ–¹å¼ï¼š`wget --output-document=è‡ªå®šä¹‰å›¾ç‰‡åç§° å›¾ç‰‡åœ°å€`
- `jquery`åº“ï¼š
  - `<link rel="stylesheet" href="https://cdn.acwing.com/static/jquery-ui-dist/jquery-ui.min.css">`
  - `<script src="https://cdn.acwing.com/static/jquery/js/jquery-3.3.1.min.js"></script>`

### æ“ä½œè·¯å¾„è®°å½•

**æˆ‘çš„ git ä»“åº“ï¼š**
- https://git.acwing.com/PiperLiu/acapp

**è®¿é—®ï¼š**
- http://49.232.99.41:8000/

#### é¦–å…ˆæ•´ç†é¡¹ç›®ç»“æ„

æˆ‘ä»¬åœ¨ `python` ä¸­è°ƒç”¨ `import urls.xxx` æ—¶ï¼Œ`urls.py` è¿˜æ˜¯ `urls` ä½œä¸ºä¸€ä¸ª `moudle` ï¼ˆæ–‡ä»¶å¤¹ï¼‰éƒ½å¯ä»¥ã€‚

è¿™é‡Œä¸ºäº†é˜²æ­¢ `urls.py` å’Œ `views.py` å¤ªå†—é•¿ï¼Œå› æ­¤åˆ æ‰å•ä¸ªæ–‡ä»¶ï¼Œæ”¹ç”¨ `moudle` ã€‚å¦‚æœæ˜¯ `moudle` çš„è¯ï¼Œéœ€è¦æœ‰ `__init__.py` å¸®åŠ© `python` è§£é‡Šå™¨è®¤å®šè¿™ä¸ªæ–‡ä»¶å¤¹æ˜¯ä¸€ä¸ª `moudle` ã€‚

```bash
acs:~/acapp$ cd game/
acs:~/acapp/game$ rm views.py
acs:~/acapp/game$ rm urls.py
acs:~/acapp/game$ mkdir views urls
```

`models` åŒç†ã€‚

```bash
acs:~/acapp/game$ rm models.py
acs:~/acapp/game$ mkdir models
```

å»ºç«‹ `__init__.py` ã€‚

```bash
acs:~/acapp/game$ touch urls/__init__.py
acs:~/acapp/game$ touch models/__init__.py
acs:~/acapp/game$ touch views/__init__.py
```

æ­¤å¤–å»ºç«‹ `static` ç®¡ç†é™æ€èµ„æºã€‚

#### ä¿®æ”¹å…¨å±€é…ç½®

##### è®¾ç½®æ—¶åŒº

åœ¨ `acapp/settings.py` ï¼š

```
-TIME_ZONE = 'UTC'
+TIME_ZONE = 'Asia/Shanghai'
```

##### æŠŠè‡ªå·±çš„appåŠ åˆ°settings

![](./images/2021110301.png)

å¦‚ä¸Šï¼Œæˆ‘ä»¬åœ¨ `settings` é‡ŒåŠ å…¥ã€‚

![](./images/2021110302.png)

##### è®¾ç½®é™æ€æ–‡ä»¶

![](./images/2021110303.png)

å¦‚ä¸Šéƒ½å¯ä»¥å­˜æ”¾é™æ€æ–‡ä»¶ï¼Œä¸€èˆ¬æ¥è®²ï¼Œ y æ€»ï¼š
- åœ¨ `static` å­˜æ”¾å¼€å‘è€…é™æ€æ–‡ä»¶
- åœ¨ `media` å­˜æ”¾ç”¨æˆ·é™æ€æ–‡ä»¶

```bash
acs:~/acapp/game$ cd static/
acs:~/acapp/game/static$ ls
acs:~/acapp/game/static$ mkdir css js image
acs:~/acapp/game/static$ cd image/
acs:~/acapp/game/static/image$ mkdir menu playground settings
acs:~/acapp/game/static/image$ ls
menu  playground  settings
```

ç”¨ `wget` åœ¨ Linux ä¸­ä¸‹è½½ã€‚

```bash
acs:~/acapp/game/static/image/menu$ wget --output-document=background.gif https://gimg2.baidu.com/image_search/src=http%3A%2F%2Finews.gtimg.com%2Fnewsapp_match%2F0%2F11156556256%2F0.jpg&refer=http%3A%2F%2Finews.gtimg.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg
[1] 507
[2] 508
[3] 509
[4] 510
[5] 511
[6] 512
[7] 513
acs:~/acapp/game/static/image/menu$
Redirecting output to 'wget-log'.

[1]   Done                    wget --output-document=background.gif https://gimg2.baidu.com/image_search/src=http%3A%2F%2Finews.gtimg.com%2Fnewsapp_match%2F0%2F11156556256%2F0.jpg
[2]   Done                    refer=http%3A%2F%2Finews.gtimg.com
[3]   Done                    app=2002
[4]   Done                    size=f9999,10000
[5]   Done                    q=a80
[6]-  Done                    n=0
[7]+  Done                    g=0n
acs:~/acapp/game/static/image/menu$ ls
background.gif  wget-log
acs:~/acapp/game/static/image/menu$ rm wget-log
```

ç°åœ¨ç›´æ¥åœ¨
```
<ä½ çš„åŸŸå/ip>:<ç«¯å£å·>/static/image/menu/background.gif
```
å°±å¯ä»¥è®¿é—®ä½ çš„å›¾ç‰‡ã€‚

#### jsæ‰“åŒ…

ä¸€äº›å…³äº `js` å’Œ `css` çš„è®²è§£æˆ‘å°±ä¸è¯¦ç»†è®°å½•äº†ğŸ˜…

å…¶ä¸­ï¼ŒæŠŠ `src` ä¸­ `js` æ‰“åŒ…æˆ `dist` ï¼Œé˜²æ­¢å¹¶è¡ŒåŠ è½½ `js` é€ æˆçš„æ•ˆæœæŸå¤±ã€‚

è¿™é‡Œ yæ€» ç”¨ `shell` æ‰“åŒ…å±å®æœ‰ç‚¹çŒ›ã€‚

åœ¨ `scripts/compress_game_js.sh` ä¸­ï¼š

```bash
#! /bin/bash

JS_PATH=/home/acs/acapp/game/static/js/
JS_PATH_DIST=${JS_PATH}dist/
JS_PATH_SRC=${JS_PATH}src/

find $JS_PATH_SRC -type f -name '*.js' | sort | xargs cat > ${JS_PATH_DIST}game.js
```

```bash
acs:~/acapp$ mkdir scripts
acs:~/acapp$ vim compress_game_js.sh
acs:~/acapp$ chmod +x compress_game_js.sh
```

#### htmlç»“æ„

```bash
acs:~/acapp/game$ ls
__init__.py  admin.py  migrations  static    urls
__pycache__  apps.py   models      tests.py  views
acs:~/acapp/game$ mkdir templates
acs:~/acapp/game$ cd templates/
acs:~/acapp/game/templates$ mkdir multiends
acs:~/acapp/game/templates$ ls
multiends
acs:~/acapp/game/templates$ mkdir menu playground settings
```

`vim multiends/web.html`ï¼š

```html
{% load static %}

<head>
    <link rel="stylesheet" href="https://cdn.acwing.com/static/jquery-ui-dist/jquery-ui.min.css">
    <script src="https://cdn.acwing.com/static/jquery/js/jquery-3.3.1.min.js"></script>
    <link rel="stylesheet" href="{% static 'css/game.css' %}">
    <script src="{% static 'js/dist/game.js' %}"></script>
</head>

<body style="margin: 0">
    <div id="ac_game_12345678"></div>
    <script>
        $(document).ready(function(){
            let ac_game = new AcGame("ac_game_12345678");
        });
    </script>
</body>
```

- è¿™é‡Œç”¨äº† Django è¯­æ³•ç³– `{% load static %}` ã€ `{% static 'css/game.css' %}` ã€ `{% static 'js/dist/game.js' %}` åŠ è½½é™æ€æ–‡ä»¶
- æœªæ¥çš„ç•Œé¢éƒ½æ˜¯åœ¨ `js` ä¸­ `AcGame` æ¸²æŸ“çš„ï¼ˆè¿™æ ·å°±åœ¨å‰ç«¯æ¸²æŸ“ï¼Œä¸ç»™æœåŠ¡å™¨å‹åŠ›ï¼‰

#### åˆå§‹åŒ– JavaScript

```bash
acs:~/acapp/game/static$ cd js
acs:~/acapp/game/static/js$ ls
acs:~/acapp/game/static/js$ mkdir src dist
acs:~/acapp/game/static/js/src$ 
acs:~/acapp/game/static/js/src$ mkdir menu playground settings
acs:~/acapp/game/static/js/src$ vim zbase.js
```

ä¸ºå•¥å« `zbase.js` ï¼Ÿ
- yæ€»ä¹ æƒ¯
- å› ä¸ºæ˜¯æ‹¿ `shell` æ ¹æ®å­—å…¸åºæ‰“åŒ…çš„ï¼Œæ‰€ä»¥ä¸ºäº†æŠŠ `zbase.js` æ”¾åœ¨æœ€å...

`/home/acs/acapp/game/static/js/src/zbase.js`ï¼š
```bash
class AcGame {
    constructor(id) {
        this.id = id;
        this.$ac_game = $('#' + id);
        this.menu = new AcGameMenu(this);
        this.playground = new AcGamePlayground(this);

        this.start();
    }

    start() {
    }
}
```

#### å†™ views å’Œ urls

ä¹‹åå†™ `views` ç”¨äºè¿”å›ç»™å®¢æˆ·ç«¯é™æ€èµ„æºã€‚

```bash
acs:~/acapp/game$ cd views/
acs:~/acapp/game/views$ ls
__init__.py
acs:~/acapp/game/views$ mkdir menu playground settings
acs:~/acapp/game/views$ cd menu/
acs:~/acapp/game/views/menu$ touch __init__.py
acs:~/acapp/game/views/menu$ cd ..
acs:~/acapp/game/views$ touch playground/__init__.py settings/__init__.py
acs:~/acapp/game/views$ tree
.
|-- __init__.py
|-- menu
|   `-- __init__.py
|-- playground
|   `-- __init__.py
`-- settings
    `-- __init__.py

3 directories, 4 files
acs:~/acapp/game/views$ vim index.py
```

`vim index.py`ï¼š
```python
from django.shortcuts import render


def index(request):
    return render(request, "multiends/web.html")
```

```bash
acs:~/acapp/game/views$ cd ..
acs:~/acapp/game$ cd urls/
acs:~/acapp/game/urls$ ls
__init__.py  __pycache__
acs:~/acapp/game/urls$ mkdir menu playground settings
acs:~/acapp/game/urls$ touch playground/__init__.py settings/__init__.py menu/__init__.py
acs:~/acapp/game/urls$ vim index.py
```

`vim index.py`ï¼š
```bash
from django.urls import path, include
from game.views.index import index


urlpatterns = [
    path("", index, name="index"),
    path("menu/", include("game.urls.menu.index")),
    path("playground/", include("game.urls.playground.index")),
    path("settings/", include("game.urls.settings.index")),
]
```

ä¸ºäº†å°† `menu.index` ã€ `playground.index` ä¸ `settings.index` å¼•å…¥ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ç›¸åº”æ¨¡å—åˆ›å»º `index.py` ã€‚

éƒ½æ˜¯ä¸€ä¸ªæ ·å­ï¼š
```python
from django.urls import path, include


urlpatterns = [
]
```

```bash
acs:~/acapp/game/urls/settings$ vim index.py
acs:~/acapp/game/urls/settings$ cd ..
acs:~/acapp/game/urls$ cp settings/index.py menu/index.py
acs:~/acapp/game/urls$ cp settings/index.py playground/index.py
acs:~/acapp/game/urls$ ls
__init__.py  __pycache__  index.py  menu  playground  settings
acs:~/acapp/game/urls$ tree
.
|-- __init__.py
|-- __pycache__
|   `-- __init__.cpython-38.pyc
|-- index.py
|-- menu
|   |-- __init__.py
|   `-- index.py
|-- playground
|   |-- __init__.py
|   `-- index.py
`-- settings
    |-- __init__.py
    `-- index.py

4 directories, 9 files
acs:~/acapp/game/urls$
```

ç„¶åå»ä¿®æ”¹å…¨å±€ urls ã€‚

![](./images/2021110304.png)

**è‡³æ­¤ï¼Œé¡¹ç›®ç»“æ„é…ç½®å®Œæˆã€‚**

#### é…ç½®å®Œæˆï¼Œå¼€å§‹å†™jsæ¸²æŸ“å‡½æ•°

```bash
acs:~/acapp/game/static/js/src$ cd menu/
acs:~/acapp/game/static/js/src/menu$ vim zbase.js
```

`zbase.js`ï¼š
```js
class AcGameMenu {
    constructor(root) {
        this.root = root;
        this.$menu = $(`
<div class="ac-game-menu">
    <div class="ac-game-menu-field">
        <div class="ac-game-menu-field-item ac-game-menu-field-item-single-mode">
            å•äººæ¨¡å¼
        </div>
        <br>
        <div class="ac-game-menu-field-item ac-game-menu-field-item-multi-mode">
            å¤šäººæ¨¡å¼
        </div>
        <br>
        <div class="ac-game-menu-field-item ac-game-menu-field-item-settings">
            è®¾ç½®
        </div>
    </div>
</div>
`);
        this.root.$ac_game.append(this.$menu);
        this.$single_mode = this.$menu.find('.ac-game-menu-field-item-single-mode');
        this.$multi_mode = this.$menu.find('.ac-game-menu-field-item-multi-mode');
        this.$settings = this.$menu.find('.ac-game-menu-field-item-settings');

        this.start();
    }

    start() {
        this.add_listening_events();
    }

    add_listening_events() {
        let outer = this;
        this.$single_mode.click(function(){
            outer.hide();
            outer.root.playground.show();
        });
        this.$multi_mode.click(function(){
            console.log("click multi mode");
        });
        this.$settings.click(function(){
            console.log("click settings");
        });
    }

    show() {  // æ˜¾ç¤ºmenuç•Œé¢
        this.$menu.show();
    }

    hide() {  // å…³é—­menuç•Œé¢
        this.$menu.hide();
    }
}
```

æ¸²æŸ“ `playground` å¯¹è±¡ã€‚

```bash
acs:~/acapp/game/static/js/src/playground$ ll
total 8
drwxrwxr-x 2 acs acs 4096 Nov  3 15:32 ./
drwxrwxr-x 5 acs acs 4096 Nov  3 16:12 ../
acs:~/acapp/game/static/js/src/playground$ vim zbase.js
```

`~/acapp/game/static/js/src/playground/zbase.js`ï¼š
```js
class AcGamePlayground {
    constructor(root) {
        this.root = root;
        this.$playground = $(`<div>æ¸¸æˆç•Œé¢</div>`);

        this.hide();
        this.root.$ac_game.append(this.$playground);

        this.start();
    }

    start() {
    }

    show() {  // æ‰“å¼€playgroundç•Œé¢
        this.$playground.show();
    }

    hide() {  // å…³é—­playgroundç•Œé¢
        this.$playground.hide();
    }
}
```

##### å†™ä¸€ä¸‹css

```bash
acs:~/acapp/game/static/js/src/menu$ cd ..
acs:~/acapp/game/static/js/src$ cd ..
acs:~/acapp/game/static/js$ cd ..
acs:~/acapp/game/static$ l
css/  image/  js/
acs:~/acapp/game/static$ cd css/
acs:~/acapp/game/static/css$ ls
game.css
acs:~/acapp/game/static/css$ vim game.css
```

`game.css`ï¼š
```css
.ac-game-menu {
    width: 100%;
    height: 100%;
    background-image: url("/static/image/menu/background.gif");
    background-size: 100% 100%;
    user-select: none;
}

.ac-game-menu-field {
    width: 20vw;
    position: relative;
    top: 40vh;
    left: 19vw;
}

.ac-game-menu-field-item {
    color: white;
    height: 7vh;
    width: 18vw;
    font-size: 6vh;
    font-style: italic;
    padding: 2vh;
    text-align: center;
    background-color: rgba(39,21,28, 0.6);
    border-radius: 10px;
    letter-spacing: 0.5vw;
    cursor: pointer;
}

.ac-game-menu-field-item:hover {
    transform: scale(1.2);
    transition: 100ms;
}
```

åœ¨æµ‹è¯•å‰ï¼Œåˆ«å¿˜äº†è¿è¡Œè„šæœ¬ï¼ŒæŠŠ `src` æ‰“åŒ…åˆ° `dist` é‡Œã€‚

```bash
acs:~/acapp$ scripts/compress_game_js.sh
```

![](./images/2021110305.png)

### æ€»ç»“

å‰ç«¯ä¸»è¦æ˜¯ç”¨ `jQuery` ï¼Œé¡µé¢ç”¨ `js` åœ¨å®¢æˆ·ç«¯æ¸²æŸ“ã€‚è·¯ç”±ç­‰å†…å®¹è¿˜æ˜¯ç”¨ `Django` åœ¨æ§åˆ¶ã€‚
