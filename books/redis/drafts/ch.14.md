# 第 14 章 服务器

<!-- @import "[TOC]" {cmd="toc" depthFrom=3 depthTo=6 orderedList=false} -->

<!-- code_chunk_output -->

- [14.1 命令请求的执行过程](#141-命令请求的执行过程)
  - [14.1.1 发送命令请求](#1411-发送命令请求)
  - [14.1.2 读取命令请求](#1412-读取命令请求)
  - [14.1.3 命令执行器（1）：查找命令实现](#1413-命令执行器1查找命令实现)
  - [14.1.4 命令执行器（2）：执行预备操作](#1414-命令执行器2执行预备操作)
  - [14.1.5 命令执行器（3）：调用命令的实现函数](#1415-命令执行器3调用命令的实现函数)
  - [14.1.6 命令执行器（4）：执行后续工作](#1416-命令执行器4执行后续工作)
  - [14.1.7 将命令回复发送给客户端](#1417-将命令回复发送给客户端)
  - [14.1.8 客户端接收并打印命令回复](#1418-客户端接收并打印命令回复)
- [14.2 serverCron 函数](#142-servercron-函数)
  - [14.2.1 更新服务器时间缓存](#1421-更新服务器时间缓存)
  - [14.2.2 更新 LRU 时钟](#1422-更新-lru-时钟)
  - [14.2.3 更新服务器每秒执行命令次数](#1423-更新服务器每秒执行命令次数)
  - [14.2.4 更新服务器内存峰值记录](#1424-更新服务器内存峰值记录)
  - [14.2.5 处理 SIGTERM 信号](#1425-处理-sigterm-信号)
  - [14.2.6 管理客户端资源](#1426-管理客户端资源)
  - [14.2.7 管理数据库资源](#1427-管理数据库资源)
  - [14.2.8 执行被延迟的 BGREWRITEAOF](#1428-执行被延迟的-bgrewriteaof)
  - [14.2.9 检查持久化操作的运行状态](#1429-检查持久化操作的运行状态)
  - [14.2.10 将 AOF 缓冲区中的内容写入 AOF 文件](#14210-将-aof-缓冲区中的内容写入-aof-文件)
  - [14.2.11 关闭异步客户端](#14211-关闭异步客户端)
  - [14.2.12 增加 cronloops 计数器的值](#14212-增加-cronloops-计数器的值)
- [14.3 初始化服务器](#143-初始化服务器)
  - [14.3.1 初始化服务器状态结构](#1431-初始化服务器状态结构)
  - [14.3.2 载入配置选项](#1432-载入配置选项)
  - [14.3.3 初始化服务器数据结构](#1433-初始化服务器数据结构)
  - [14.3.4 还原数据库状态](#1434-还原数据库状态)
  - [14.3.5 执行事件循环](#1435-执行事件循环)

<!-- /code_chunk_output -->

### 14.1 命令请求的执行过程

#### 14.1.1 发送命令请求

#### 14.1.2 读取命令请求

#### 14.1.3 命令执行器（1）：查找命令实现

#### 14.1.4 命令执行器（2）：执行预备操作

#### 14.1.5 命令执行器（3）：调用命令的实现函数

#### 14.1.6 命令执行器（4）：执行后续工作

#### 14.1.7 将命令回复发送给客户端

#### 14.1.8 客户端接收并打印命令回复

### 14.2 serverCron 函数

Redis 3.0 中完全单线程处理。

#### 14.2.1 更新服务器时间缓存

#### 14.2.2 更新 LRU 时钟

#### 14.2.3 更新服务器每秒执行命令次数

#### 14.2.4 更新服务器内存峰值记录

#### 14.2.5 处理 SIGTERM 信号

#### 14.2.6 管理客户端资源

#### 14.2.7 管理数据库资源

#### 14.2.8 执行被延迟的 BGREWRITEAOF

#### 14.2.9 检查持久化操作的运行状态

#### 14.2.10 将 AOF 缓冲区中的内容写入 AOF 文件

#### 14.2.11 关闭异步客户端

#### 14.2.12 增加 cronloops 计数器的值

### 14.3 初始化服务器

#### 14.3.1 初始化服务器状态结构

#### 14.3.2 载入配置选项

#### 14.3.3 初始化服务器数据结构

#### 14.3.4 还原数据库状态

#### 14.3.5 执行事件循环
